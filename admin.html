<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- SECURITY: Prevent MIME type sniffing attacks (OWASP) -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <title>ISTE Admin Portal</title>
    <meta name="description" content="ISTE Club Admin Portal - Manage events, registrations, and winners." />
    <!-- SECURITY: reCAPTCHA v3 for invisible bot protection on admin login -->
    <script src="https://www.google.com/recaptcha/api.js?render=6LeeoD8sAAAAAGKAdRH9D4ca5FHGsip-XXGcXOzM"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Outfit:wght@400;500;600;700;800&display=swap"
        rel="stylesheet" />
    <style>
        :root {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-card: rgba(255, 255, 255, 0.95);
            --bg-input: #f1f5f9;
            --glass: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(99, 102, 241, 0.15);
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --accent-1: #6366f1;
            --accent-2: #8b5cf6;
            --accent-3: #a855f7;
            --accent-cyan: #06b6d4;
            --accent-pink: #ec4899;
            --accent-green: #10b981;
            --accent-orange: #f59e0b;
            --accent-red: #ef4444;
            --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
            --gradient-button: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --gradient-danger: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --gradient-warning: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            --gradient-soft: linear-gradient(135deg, #e0e7ff 0%, #ede9fe 50%, #fae8ff 100%);
            --shadow-soft: 0 4px 20px rgba(99, 102, 241, 0.12);
            --shadow-card: 0 8px 32px rgba(99, 102, 241, 0.08);
            --shadow-glow: 0 0 30px rgba(99, 102, 241, 0.2);
            --radius-sm: 12px;
            --radius-md: 16px;
            --radius-lg: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* ===== ANIMATED BACKGROUND ===== */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            background: linear-gradient(135deg, #f0f4ff 0%, #e8e0ff 50%, #fce7f3 100%);
        }

        .bg-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.5;
            animation: float 20s ease-in-out infinite;
        }

        .bg-orb-1 {
            width: 600px;
            height: 600px;
            background: linear-gradient(135deg, #c7d2fe, #ddd6fe);
            top: -200px;
            left: -200px;
        }

        .bg-orb-2 {
            width: 500px;
            height: 500px;
            background: linear-gradient(135deg, #fae8ff, #f5d0fe);
            bottom: -150px;
            right: -150px;
            animation-delay: -7s;
        }

        .bg-orb-3 {
            width: 300px;
            height: 300px;
            background: linear-gradient(135deg, #a5f3fc, #c4b5fd);
            top: 40%;
            left: 60%;
            animation-delay: -3s;
        }

        @keyframes float {

            0%,
            100% {
                transform: translate(0, 0) scale(1);
            }

            25% {
                transform: translate(30px, 30px) scale(1.05);
            }

            50% {
                transform: translate(-20px, 50px) scale(0.95);
            }

            75% {
                transform: translate(25px, -25px) scale(1.02);
            }
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gradient-primary);
            border-radius: 4px;
        }

        /* ===== NAVBAR (More Transparent) ===== */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 6%;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(99, 102, 241, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 18px;
            text-decoration: none;
        }

        .logo img {
            width: 55px;
            height: auto;
            transition: transform 0.3s ease;
        }

        .logo:hover img {
            transform: scale(1.05);
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo-text span {
            font-family: 'Outfit', sans-serif;
            font-size: 24px;
            font-weight: 800;
            color: var(--text-primary);
            letter-spacing: 2px;
        }

        .logo-text small {
            font-size: 9px;
            color: var(--text-secondary);
            letter-spacing: 1.5px;
            text-transform: uppercase;
            font-weight: 500;
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 13px;
            font-weight: 600;
            padding: 10px 16px;
            border-radius: var(--radius-sm);
            transition: all 0.3s ease;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--accent-1);
            background: rgba(99, 102, 241, 0.1);
        }

        .hamburger {
            display: none;
            flex-direction: column;
            gap: 5px;
            cursor: pointer;
            padding: 10px;
        }

        .hamburger span {
            width: 24px;
            height: 2.5px;
            background: var(--accent-1);
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        /* ===== ADMIN WRAPPER ===== */
        /* ===== ADMIN WRAPPER ===== */
        .admin-wrapper {
            min-height: 100vh;
            padding: 90px 5% 40px;
        }

        .admin-wrapper.active {
            display: block;
        }

        /* ===== LOGIN PAGE ===== */



        .login-container {
            min-height: calc(100vh - 140px);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .login-box {
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: 3rem;
            max-width: 420px;
            width: 100%;
            box-shadow: var(--shadow-card);
            position: relative;
            overflow: hidden;
        }

        .login-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .login-box h2 {
            text-align: center;
            margin-bottom: 2rem;
            font-family: 'Outfit', sans-serif;
            font-size: 1.8rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 14px 18px;
            background: var(--bg-input);
            border: 2px solid transparent;
            border-radius: var(--radius-sm);
            font-size: 15px;
            font-family: inherit;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--accent-1);
            background: #fff;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .btn {
            width: 100%;
            padding: 16px;
            background: var(--gradient-button);
            color: #fff;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 15px;
            font-family: inherit;
            font-weight: 700;
            margin-top: 1rem;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow);
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            color: var(--accent-red);
            padding: 0.75rem;
            border-radius: var(--radius-sm);
            text-align: center;
            display: none;
            margin-top: 1rem;
            font-size: 14px;
        }

        /* Password Input with Toggle Button */
        .password-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .password-input-wrapper input {
            width: 100%;
            padding-right: 48px;
        }

        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            opacity: 0.6;
            transition: all 0.2s ease;
            border-radius: 4px;
        }

        .password-toggle:hover {
            opacity: 1;
            color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.08);
        }

        .password-toggle:focus {
            outline: none;
            opacity: 1;
            color: var(--accent-primary);
        }

        /* Mobile Hamburger Menu - Frosted Glass Effect */
        @media (max-width: 768px) {
            .nav-links {
                background: rgba(255, 255, 255, 0.92);
                backdrop-filter: blur(20px) saturate(180%);
                -webkit-backdrop-filter: blur(20px) saturate(180%);
                border-left: 1px solid rgba(99, 102, 241, 0.2);
            }
        }

        /* ===== DASHBOARD ===== */
        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        /* Dashboard Header */
        .dashboard-header {
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: 24px 32px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            box-shadow: var(--shadow-card);
        }

        .dashboard-header-left h2 {
            font-family: 'Outfit', sans-serif;
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .dashboard-header-left p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .logout-btn {
            padding: 12px 28px;
            background: var(--gradient-danger);
            color: #fff;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-family: inherit;
            font-weight: 700;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.25);
        }

        /* Overview Cards */
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .overview-card {
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-md);
            padding: 24px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-card);
            transition: all 0.3s ease;
        }

        .overview-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-glow);
        }

        .overview-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
        }

        .overview-card.purple::before {
            background: var(--gradient-primary);
        }

        .overview-card.green::before {
            background: var(--gradient-success);
        }

        .overview-card.orange::before {
            background: var(--gradient-warning);
        }

        .overview-card.pink::before {
            background: linear-gradient(135deg, #ec4899, #f472b6);
        }

        .overview-card-icon {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 16px;
        }

        .overview-card.purple .overview-card-icon {
            background: rgba(99, 102, 241, 0.1);
        }

        .overview-card.green .overview-card-icon {
            background: rgba(16, 185, 129, 0.1);
        }

        .overview-card.orange .overview-card-icon {
            background: rgba(245, 158, 11, 0.1);
        }

        .overview-card.pink .overview-card-icon {
            background: rgba(236, 72, 153, 0.1);
        }

        .overview-card h3 {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .overview-card .number {
            font-family: 'Outfit', sans-serif;
            font-size: 36px;
            font-weight: 800;
            color: var(--text-primary);
        }

        .overview-card .change {
            font-size: 12px;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .overview-card .change.positive {
            color: var(--accent-green);
        }

        .overview-card .change.info {
            color: var(--accent-1);
        }

        /* Main Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        /* Event Tabs Container */
        .event-tabs-container {
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-card);
        }

        .event-tabs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .event-tabs-header h3 {
            font-family: 'Outfit', sans-serif;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Event Tabs (Main) */
        .event-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .event-tab {
            padding: 12px 24px;
            background: var(--bg-input);
            border: 2px solid transparent;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-family: inherit;
            font-weight: 700;
            font-size: 14px;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .event-tab:hover {
            border-color: var(--accent-1);
            color: var(--accent-1);
            transform: translateY(-2px);
        }

        .event-tab.active {
            background: var(--gradient-button);
            color: #fff;
            border-color: transparent;
            box-shadow: var(--shadow-soft);
        }

        .event-content {
            display: none;
        }

        .event-content.active {
            display: block;
        }

        /* Sub Tabs (Inside each event) */
        .sub-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--bg-input);
            padding-bottom: 12px;
        }

        .sub-tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            font-size: 13px;
            color: var(--text-muted);
            transition: all 0.3s ease;
            position: relative;
        }

        .sub-tab:hover {
            color: var(--accent-1);
        }

        .sub-tab.active {
            color: var(--accent-1);
            background: rgba(99, 102, 241, 0.1);
        }

        .sub-tab.active::after {
            content: '';
            position: absolute;
            bottom: -14px;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 3px;
            background: var(--gradient-button);
            border-radius: 2px;
        }

        .sub-content {
            display: none;
        }

        .sub-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===== LUMINOUS GLASS DATA GRID ===== */
        .data-table-wrapper {
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-card);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .data-table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.5);
        }

        .data-table-title {
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .data-table-controls {
            display: flex;
            gap: 12px;
        }

        .table-search-input {
            padding: 10px 16px 10px 40px;
            background: var(--bg-input);
            border: 1px solid transparent;
            border-radius: 50px;
            font-size: 13px;
            width: 220px;
            transition: all 0.3s ease;
        }

        .table-search-input:focus {
            outline: none;
            background: #fff;
            border-color: var(--accent-1);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
            width: 260px;
        }

        .search-wrapper {
            position: relative;
        }

        .search-wrapper .search-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 14px;
            pointer-events: none;
        }

        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .data-table thead th {
            padding: 16px 24px;
            text-align: left;
            font-family: 'Outfit', sans-serif;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: #fff;
            background: var(--gradient-button);
            border-bottom: none;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }

        .data-table thead th:first-child {
            border-radius: var(--radius-sm) 0 0 0;
        }

        .data-table thead th:last-child {
            border-radius: 0 var(--radius-sm) 0 0;
        }

        .data-table thead th:hover {
            background: linear-gradient(135deg, #5558e8 0%, #7c4ddb 100%);
            color: #fff;
        }

        .data-table tbody tr {
            transition: all 0.25s ease;
        }

        .data-table tbody td {
            padding: 16px 24px;
            font-size: 14px;
            color: var(--text-primary);
            border-bottom: 1px solid rgba(99, 102, 241, 0.05);
            background: transparent;
        }

        /* Lightswind "Lift" Effect on Hover */
        .data-table tbody tr:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.08);
            position: relative;
            z-index: 10;
        }

        .data-table tbody tr:hover td {
            background: rgba(255, 255, 255, 0.7);
        }

        .data-table tbody tr:last-child td {
            border-bottom: none;
        }

        /* Status Pills */
        .status-pill {
            display: inline-flex;
            align-items: center;
            padding: 5px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pill.verified,
        .status-pill.active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--accent-green);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .status-pill.pending {
            background: rgba(245, 158, 11, 0.1);
            color: var(--accent-orange);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .status-pill.inactive {
            background: rgba(100, 116, 139, 0.1);
            color: var(--text-secondary);
            border: 1px solid rgba(100, 116, 139, 0.2);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 16px;
            padding: 6px;
            border-radius: 8px;
            opacity: 0.5;
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            opacity: 1;
            background: rgba(99, 102, 241, 0.1);
        }

        .action-btn.delete:hover {
            background: rgba(239, 68, 68, 0.1);
        }

        .action-btn.verify:hover {
            background: rgba(16, 185, 129, 0.1);
        }

        /* Clickable status pills */
        .status-pill.clickable {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .status-pill.clickable:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .team-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: var(--gradient-button);
            color: #fff;
            border-radius: 10px;
            font-weight: 800;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        /* SECURITY: Hide reCAPTCHA badge (logic still runs) */
        .grecaptcha-badge {
            visibility: hidden !important;
            opacity: 0 !important;
            position: absolute !important;
            right: -9999px !important;
        }

        /* Refresh Button - Lightswind-style (minimal, unobtrusive) */
        .table-refresh-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: var(--bg-input);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-right: 12px;
        }

        .table-refresh-btn:hover {
            background: var(--bg-card);
            border-color: var(--accent-primary);
            transform: rotate(45deg);
        }

        .table-refresh-btn:active {
            transform: rotate(180deg);
        }

        .table-refresh-btn.spinning .refresh-icon {
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .refresh-icon {
            font-size: 18px;
            color: var(--text-muted);
            transition: color 0.2s ease;
        }

        .table-refresh-btn:hover .refresh-icon {
            color: var(--accent-primary);
        }

        .member-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .member-info .name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .member-info .detail {
            font-size: 11px;
            color: var(--text-muted);
            background: var(--bg-input);
            padding: 2px 8px;
            border-radius: 4px;
            display: inline-block;
            width: fit-content;
        }

        .email-link {
            color: var(--accent-1);
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
        }

        .email-link:hover {
            text-decoration: underline;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 20px;
        }

        .page-btn {
            width: 40px;
            height: 40px;
            border: 2px solid var(--glass-border);
            background: #fff;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .page-btn:hover {
            border-color: var(--accent-1);
            color: var(--accent-1);
        }

        .page-btn.active {
            background: var(--gradient-button);
            color: #fff;
            border-color: transparent;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-info {
            font-size: 13px;
            color: var(--text-muted);
            margin: 0 12px;
        }

        /* Quick Actions Sidebar */
        .sidebar-card {
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-card);
            margin-bottom: 24px;
        }

        .sidebar-card h3 {
            font-family: 'Outfit', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .quick-action {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 16px;
            background: var(--bg-input);
            border-radius: var(--radius-sm);
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .quick-action:hover {
            background: rgba(99, 102, 241, 0.08);
            border-color: var(--accent-1);
            transform: translateX(5px);
        }

        .quick-action:last-child {
            margin-bottom: 0;
        }

        .quick-action-icon {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .quick-action-icon.purple {
            background: rgba(99, 102, 241, 0.15);
        }

        .quick-action-icon.green {
            background: rgba(16, 185, 129, 0.15);
        }

        .quick-action-icon.orange {
            background: rgba(245, 158, 11, 0.15);
        }

        .quick-action-text h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .quick-action-text p {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Recent Activity */
        .activity-item {
            display: flex;
            gap: 12px;
            padding: 14px 0;
            border-bottom: 1px solid rgba(99, 102, 241, 0.08);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-top: 5px;
            flex-shrink: 0;
        }

        .activity-dot.purple {
            background: var(--accent-1);
        }

        .activity-dot.green {
            background: var(--accent-green);
        }

        .activity-dot.orange {
            background: var(--accent-orange);
        }

        .activity-info h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .activity-info p {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Winners Display */
        .winners-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 16px;
        }

        .winner-mini-card {
            background: linear-gradient(135deg, #fefce8, #fef3c7);
            border: 2px solid rgba(245, 158, 11, 0.2);
            border-radius: var(--radius-md);
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .winner-mini-card:first-child {
            background: linear-gradient(135deg, #fef9c3, #fde047);
            border-color: rgba(234, 179, 8, 0.3);
        }

        .winner-mini-card:nth-child(2) {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            border-color: rgba(148, 163, 184, 0.3);
        }

        .winner-mini-card:nth-child(3) {
            background: linear-gradient(135deg, #fed7aa, #fdba74);
            border-color: rgba(251, 146, 60, 0.3);
        }

        .winner-mini-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-glow);
        }

        .winner-mini-card .medal {
            font-size: 42px;
            margin-bottom: 12px;
        }

        .winner-mini-card h4 {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .winner-mini-card p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Placeholder */
        .placeholder-box {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .placeholder-box .icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .placeholder-box h4 {
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 18px;
        }

        .placeholder-box p {
            font-size: 14px;
        }

        /* ===== EVENT SELECTION GRID ===== */
        .event-selector-view {
            display: block;
        }

        .event-selector-view.hidden {
            display: none;
        }

        .event-detail-view {
            display: none;
        }

        .event-detail-view.active {
            display: block;
        }

        .event-selector-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 24px;
        }

        .event-select-card {
            background: var(--bg-card);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: 32px 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .event-select-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .event-select-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-glow);
            border-color: var(--accent-1);
        }

        .event-select-card:hover::before {
            transform: scaleX(1);
        }

        .event-select-card .icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .event-select-card h4 {
            font-family: 'Outfit', sans-serif;
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .event-select-card .count {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: var(--gradient-soft);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            color: var(--accent-1);
            margin-top: 8px;
        }

        .back-to-events {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: transparent;
            border: 2px solid var(--glass-border);
            padding: 10px 20px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .back-to-events:hover {
            border-color: var(--accent-1);
            color: var(--accent-1);
            transform: translateX(-4px);
        }

        /* ===== WINNER BADGE IN TABLE ===== */
        .winner-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: linear-gradient(135deg, #fef3c7, #fde047);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            color: #92400e;
            border: 1px solid rgba(234, 179, 8, 0.3);
        }

        .winner-badge.gold {
            background: linear-gradient(135deg, #fef3c7, #fde047);
            color: #92400e;
        }

        .winner-badge.silver {
            background: linear-gradient(135deg, #f1f5f9, #cbd5e1);
            color: #475569;
        }

        .winner-badge.bronze {
            background: linear-gradient(135deg, #fed7aa, #fdba74);
            color: #9a3412;
        }

        /* ===== SET WINNER BUTTON ===== */
        .action-btn.winner {
            background: transparent;
        }

        .action-btn.winner:hover {
            background: rgba(234, 179, 8, 0.15);
        }

        /* ===== WINNER MODAL ===== */
        .winner-position-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 24px 0;
        }

        .winner-position-btn {
            background: var(--bg-input);
            border: 2px solid transparent;
            border-radius: var(--radius-md);
            padding: 24px 16px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }

        .winner-position-btn:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-soft);
        }

        .winner-position-btn.gold:hover,
        .winner-position-btn.gold.selected {
            background: linear-gradient(135deg, #fef3c7, #fde047);
            border-color: #f59e0b;
        }

        .winner-position-btn.silver:hover,
        .winner-position-btn.silver.selected {
            background: linear-gradient(135deg, #f1f5f9, #cbd5e1);
            border-color: #94a3b8;
        }

        .winner-position-btn.bronze:hover,
        .winner-position-btn.bronze.selected {
            background: linear-gradient(135deg, #fed7aa, #fdba74);
            border-color: #f97316;
        }

        .winner-position-btn .medal {
            font-size: 36px;
            margin-bottom: 8px;
        }

        .winner-position-btn .label {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* ===== ROUTING CONFIG CARD ===== */
        .routing-config-card {
            background: var(--bg-card);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
        }

        .routing-config-card h4 {
            font-family: 'Outfit', sans-serif;
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .routing-select {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-input);
            border: 2px solid transparent;
            border-radius: var(--radius-sm);
            font-family: inherit;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2'%3E%3Cpolyline points='6,9 12,15 18,9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 18px;
        }

        .routing-select:focus {
            outline: none;
            border-color: var(--accent-1);
            background-color: #fff;
        }

        .routing-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            font-size: 13px;
            color: var(--accent-green);
            font-weight: 600;
        }

        .routing-status .dot {
            width: 8px;
            height: 8px;
            background: var(--accent-green);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* ===== CREATE EVENT MODAL ===== */
        .create-event-form .emoji-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-top: 8px;
        }

        .emoji-option {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: var(--bg-input);
            border: 2px solid transparent;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .emoji-option:hover {
            transform: scale(1.1);
            border-color: var(--accent-1);
        }

        .emoji-option.selected {
            background: var(--gradient-soft);
            border-color: var(--accent-1);
        }

        /* ===== CUSTOM DROPDOWN (Lightswind-inspired) ===== */
        .custom-select {
            position: relative;
            width: 100%;
        }

        .select-trigger {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 12px 16px;
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .select-trigger:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
        }

        .select-trigger:focus {
            outline: none;
            border-color: var(--accent-1);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .select-trigger .selected-value {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .select-trigger .chevron {
            width: 16px;
            height: 16px;
            color: #64748b;
            transition: transform 0.2s ease;
        }

        .custom-select.open .select-trigger .chevron {
            transform: rotate(180deg);
        }

        .select-content {
            position: absolute;
            top: calc(100% + 6px);
            left: 0;
            width: 100%;
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-shadow:
                0 10px 38px -10px rgba(22, 23, 24, 0.35),
                0 10px 20px -15px rgba(22, 23, 24, 0.2);
            padding: 4px;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px) scale(0.96);
            transition: all 0.15s ease;
        }

        .custom-select.open .select-content {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        .select-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .select-item:hover {
            background: #f1f5f9;
        }

        .select-item.selected {
            background: rgba(99, 102, 241, 0.08);
            color: var(--accent-1);
        }

        .select-item .icon {
            font-size: 16px;
        }

        .select-item .check {
            margin-left: auto;
            opacity: 0;
            color: var(--accent-1);
            font-weight: 700;
        }

        .select-item.selected .check {
            opacity: 1;
        }

        /* Routing Config Card Styling */
        .routing-config-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.03), rgba(139, 92, 246, 0.03));
            border: 1px solid rgba(99, 102, 241, 0.15);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .routing-config-card h4 {
            margin: 0 0 14px 0;
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .routing-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 14px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .routing-status .dot {
            width: 8px;
            height: 8px;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.6;
                transform: scale(1.15);
            }
        }

        .routing-status strong {
            color: var(--accent-1);
            font-weight: 700;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--gradient-button);
            color: #fff;
            padding: 16px 24px;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-glow);
            font-weight: 600;
            font-size: 14px;
            z-index: 9999;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .overview-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            nav {
                padding: 12px 4%;
            }

            .nav-links {
                position: fixed;
                top: 0;
                right: -100%;
                width: 260px;
                height: 100vh;
                background: var(--bg-secondary);
                flex-direction: column;
                padding: 80px 20px 20px;
                gap: 8px;
                transition: right 0.4s ease;
                box-shadow: -10px 0 30px rgba(0, 0, 0, 0.1);
            }

            .nav-links.active {
                right: 0;
            }

            .nav-links a {
                width: 100%;
                text-align: center;
                padding: 14px;
            }

            .hamburger {
                display: flex;
            }

            .admin-wrapper {
                padding: 80px 4% 30px;
            }

            .overview-grid {
                grid-template-columns: 1fr;
            }

            .winners-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-header {
                padding: 20px;
            }

            .dashboard-header-left h2 {
                font-size: 1.4rem;
            }

            .sub-tabs {
                flex-wrap: wrap;
            }
        }

        /* ===== MODALS ===== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(8px);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: 32px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 25px 50px rgba(99, 102, 241, 0.15);
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-family: 'Outfit', sans-serif;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-muted);
            transition: color 0.2s;
        }

        .modal-close:hover {
            color: var(--accent-red);
        }

        .modal-body {
            margin-bottom: 24px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-input);
            border: 1px solid transparent;
            border-radius: var(--radius-sm);
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--accent-1);
            background: #fff;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .btn {
            padding: 12px 24px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .btn-secondary {
            background: var(--bg-input);
            color: var(--text-secondary);
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        .btn-primary {
            background: var(--gradient-button);
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .btn-danger {
            background: var(--gradient-danger);
            color: #fff;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .delete-warning {
            text-align: center;
            padding: 20px 0;
        }

        .delete-warning .icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .delete-warning p {
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .delete-warning strong {
            color: var(--text-primary);
        }

        /* ===== BULK ACTION BAR ===== */
        .bulk-action-bar {
            display: none;
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: 12px 24px;
            box-shadow: var(--shadow-card), 0 10px 40px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            align-items: center;
            gap: 16px;
            backdrop-filter: blur(12px);
        }

        .bulk-action-bar.active {
            display: flex;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateX(-50%) translateY(100%);
                opacity: 0;
            }

            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        .bulk-count {
            font-weight: 600;
            color: var(--accent-1);
            min-width: 100px;
        }

        .bulk-actions {
            display: flex;
            gap: 8px;
        }

        .bulk-btn {
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            border: none;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .bulk-btn.verify {
            background: var(--gradient-success);
            color: #fff;
        }

        .bulk-btn.delete {
            background: var(--gradient-danger);
            color: #fff;
        }

        .bulk-btn.cancel {
            background: var(--bg-input);
            color: var(--text-secondary);
            border: 1px solid var(--glass-border);
        }

        .bulk-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-soft);
        }

        /* Table checkbox */
        .row-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--accent-1);
        }

        /* ===== FILTER BAR ===== */
        .filter-bar {
            display: none;
            flex-wrap: wrap;
            gap: 12px;
            padding: 16px;
            background: var(--bg-input);
            border-radius: var(--radius-md);
            margin-bottom: 16px;
            align-items: flex-end;
        }

        .filter-bar.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .filter-group label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-group input,
        .filter-group select {
            padding: 8px 12px;
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-sm);
            font-size: 13px;
            color: var(--text-primary);
            min-width: 140px;
        }

        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: var(--accent-1);
        }

        .filter-actions {
            display: flex;
            gap: 8px;
        }

        .filter-btn {
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
        }

        .filter-btn.apply {
            background: var(--gradient-button);
            color: #fff;
        }

        .filter-btn.clear {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--glass-border);
        }

        .filter-toggle-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: var(--bg-input);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-sm);
            font-size: 13px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-toggle-btn:hover {
            border-color: var(--accent-1);
            color: var(--accent-1);
        }

        .filter-toggle-btn.active {
            background: rgba(99, 102, 241, 0.1);
            border-color: var(--accent-1);
            color: var(--accent-1);
        }
    </style>
</head>

<body>
    <!-- Animated Background -->
    <div class="bg-animation">
        <div class="bg-orb bg-orb-1"></div>
        <div class="bg-orb bg-orb-2"></div>
        <div class="bg-orb bg-orb-3"></div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">Action completed!</div>

    <!-- Bulk Action Bar -->
    <div class="bulk-action-bar" id="bulkActionBar">
        <span class="bulk-count" id="bulkCount">0 selected</span>
        <div class="bulk-actions">
            <button class="bulk-btn verify" onclick="bulkUpdateStatus('verified')"> Verify</button>
            <button class="bulk-btn delete" onclick="bulkDeleteSelected()"> Delete</button>
            <button class="bulk-btn cancel" onclick="clearBulkSelection()">Cancel</button>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal-overlay" id="editModal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <span class="modal-title"> Edit Team</span>
                <button class="modal-close" onclick="closeModal('editModal')">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 60vh; overflow-y: auto;">
                <input type="hidden" id="editTeamId">

                <p
                    style="font-size: 12px; color: var(--text-muted); margin-bottom: 16px; text-transform: uppercase; letter-spacing: 1px;">
                     Team Info</p>
                <div class="form-group">
                    <label>Team Name</label>
                    <input type="text" id="editTeamName" placeholder="e.g. Code Crushers">
                </div>

                <p
                    style="font-size: 12px; color: var(--text-muted); margin: 20px 0 16px; text-transform: uppercase; letter-spacing: 1px;">
                     Member 1</p>
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="editM1Name" placeholder="Enter name">
                </div>
                <div class="form-group">
                    <label>Details (USN  Dept)</label>
                    <input type="text" id="editM1Detail" placeholder="1CR23CS001  CSE">
                </div>

                <p
                    style="font-size: 12px; color: var(--text-muted); margin: 20px 0 16px; text-transform: uppercase; letter-spacing: 1px;">
                     Member 2</p>
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="editM2Name" placeholder="Enter name">
                </div>
                <div class="form-group">
                    <label>Details (USN  Dept)</label>
                    <input type="text" id="editM2Detail" placeholder="1CR23CS002  CSE">
                </div>

                <p
                    style="font-size: 12px; color: var(--text-muted); margin: 20px 0 16px; text-transform: uppercase; letter-spacing: 1px;">
                     Member 3</p>
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="editM3Name" placeholder="Enter name (optional)">
                </div>
                <div class="form-group">
                    <label>Details (USN  Dept)</label>
                    <input type="text" id="editM3Detail" placeholder="1CR23CS003  CSE">
                </div>

                <p
                    style="font-size: 12px; color: var(--text-muted); margin: 20px 0 16px; text-transform: uppercase; letter-spacing: 1px;">
                     Contact</p>
                <div class="form-group">
                    <label>Team Email</label>
                    <input type="email" id="editEmail" placeholder="team@example.com">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('editModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveEdit()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title"> Delete Team</span>
                <button class="modal-close" onclick="closeModal('deleteModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="deleteTeamId">
                <div class="delete-warning">
                    <div class="icon"></div>
                    <p>Are you sure you want to delete</p>
                    <p><strong id="deleteTeamName">Team 1</strong>?</p>
                    <p style="color: var(--accent-red); font-size: 12px; margin-top: 12px;">This action cannot be
                        undone.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('deleteModal')">Cancel</button>
                <button class="btn btn-danger" onclick="confirmDelete()">Delete</button>
            </div>
        </div>
    </div>

    <!-- Winner Modal -->
    <div class="modal-overlay" id="winnerModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title"> Set Winner</span>
                <button class="modal-close" onclick="closeModal('winnerModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="winnerTeamId">
                <input type="hidden" id="winnerEventCode">
                <p style="text-align: center; margin-bottom: 8px;">Setting winner for:</p>
                <p style="text-align: center; font-weight: 700; font-size: 18px; color: var(--text-primary);"
                    id="winnerTeamName">Team Name</p>

                <div class="winner-position-grid">
                    <button type="button" class="winner-position-btn gold" onclick="selectWinnerPosition(1, this)">
                        <div class="medal"></div>
                        <div class="label">1st Place</div>
                    </button>
                    <button type="button" class="winner-position-btn silver" onclick="selectWinnerPosition(2, this)">
                        <div class="medal"></div>
                        <div class="label">2nd Place</div>
                    </button>
                    <button type="button" class="winner-position-btn bronze" onclick="selectWinnerPosition(3, this)">
                        <div class="medal"></div>
                        <div class="label">3rd Place</div>
                    </button>
                </div>
                <input type="hidden" id="selectedWinnerPosition" value="">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('winnerModal')">Cancel</button>
                <button class="btn btn-primary" onclick="confirmSetWinner()" id="confirmWinnerBtn">Set as
                    Winner</button>
            </div>
        </div>
    </div>

    <!-- Create Event Modal -->
    <div class="modal-overlay" id="createEventModal">
        <div class="modal" style="max-width: 520px;">
            <div class="modal-header">
                <span class="modal-title"> Create New Event</span>
                <button class="modal-close" onclick="closeModal('createEventModal')">&times;</button>
            </div>
            <div class="modal-body create-event-form">
                <div class="form-group">
                    <label>Event Name</label>
                    <input type="text" id="newEventName" placeholder="e.g. Code Sprint 2.0">
                </div>
                <div class="form-group">
                    <label>Event Code (lowercase, no spaces)</label>
                    <input type="text" id="newEventCode" placeholder="e.g. codesprint" pattern="[a-z0-9_]+"
                        oninput="this.value = this.value.toLowerCase().replace(/[^a-z0-9_]/g, '')">
                </div>
                <div class="form-group">
                    <label>Select Icon</label>
                    <div class="emoji-picker" id="emojiPicker">
                        <button type="button" class="emoji-option selected" data-emoji=""
                            onclick="selectEventEmoji('', this)"></button>
                        <button type="button" class="emoji-option" data-emoji=""
                            onclick="selectEventEmoji('', this)"></button>
                        <button type="button" class="emoji-option" data-emoji=""
                            onclick="selectEventEmoji('', this)"></button>
                        <button type="button" class="emoji-option" data-emoji=""
                            onclick="selectEventEmoji('', this)"></button>
                        <button type="button" class="emoji-option" data-emoji=""
                            onclick="selectEventEmoji('', this)"></button>
                        <button type="button" class="emoji-option" data-emoji=""
                            onclick="selectEventEmoji('', this)"></button>
                        <button type="button" class="emoji-option" data-emoji=""
                            onclick="selectEventEmoji('', this)"></button>
                        <button type="button" class="emoji-option" data-emoji=""
                            onclick="selectEventEmoji('', this)"></button>
                        <button type="button" class="emoji-option" data-emoji=""
                            onclick="selectEventEmoji('', this)"></button>
                        <button type="button" class="emoji-option" data-emoji=""
                            onclick="selectEventEmoji('', this)"></button>
                        <button type="button" class="emoji-option" data-emoji=""
                            onclick="selectEventEmoji('', this)"></button>
                        <button type="button" class="emoji-option" data-emoji=""
                            onclick="selectEventEmoji('', this)"></button>
                    </div>
                    <input type="hidden" id="selectedEventEmoji" value="">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('createEventModal')">Cancel</button>
                <button class="btn btn-primary" onclick="createNewEvent()">Create Event</button>
            </div>
        </div>
    </div>

    <nav id="navbar">
        <a href="index.html" class="logo">
            <img src="images/download.png" alt="ISTE Logo" />
            <div class="logo-text">
                <span>ISTE</span>
                <small>Admin Portal</small>
            </div>
        </a>
        <div class="nav-links" id="navLinks">
            <a href="index.html">Home</a>
            <a href="index.html#about">About</a>
            <a href="index.html#activity">Events</a>
            <a href="index.html#winners">Winners</a>
            <a href="index.html#gallery">Gallery</a>
            <a href="#" class="active">Admin</a>
        </div>
        <div class="hamburger" id="hamburger" onclick="toggleNav()" aria-label="Toggle navigation menu" role="button"
            tabindex="0">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </nav>

    <div class="admin-wrapper">
        <!-- LOGIN PAGE -->
        <div id="login-page" class="login-container">
            <div class="login-box">
                <h2> Admin Login</h2>
                <!-- SECURITY: Rate limit message shown only after failed login attempt -->
                <form id="loginForm" onsubmit="handleLogin(event); return false;">
                    <div class="form-group">
                        <label> Email Address</label>
                        <!-- SECURITY: maxlength and autocomplete attributes -->
                        <input type="email" id="username" placeholder="Enter your email" required maxlength="100"
                            autocomplete="email" />
                    </div>
                    <div class="form-group">
                        <label> Password</label>
                        <!-- SECURITY: minlength for brute force prevention -->
                        <div class="password-input-wrapper">
                            <input type="password" id="password" placeholder="Enter password" required minlength="8"
                                maxlength="128" autocomplete="current-password" />
                            <button type="button" class="password-toggle" id="passwordToggle"
                                onclick="togglePasswordVisibility()" aria-label="Toggle password visibility">
                                <svg class="eye-open" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                                <svg class="eye-closed" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" style="display: none;">
                                    <path
                                        d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24">
                                    </path>
                                    <line x1="1" y1="1" x2="23" y2="23"></line>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="error-message" id="errorMessage"> Invalid email or password</div>
                    <button type="submit" class="btn" id="loginBtn">Sign In</button>
                </form>
            </div>
        </div>

        <!-- ADMIN DASHBOARD -->
        <div id="admin-dashboard" class="dashboard">
            <!-- Dashboard Header -->
            <div class="dashboard-header">
                <div class="dashboard-header-left">
                    <h2> Dashboard Overview</h2>
                    <p>Welcome back! Here's what's happening with your events.</p>
                </div>
                <button id="logoutBtn" class="logout-btn" onclick="handleLogout()">Logout</button>
            </div>

            <!-- Overview Cards -->
            <div class="overview-grid">
                <div class="overview-card purple">
                    <div class="overview-card-icon"></div>
                    <h3>Total Teams</h3>
                    <div class="number">18</div>
                    <div class="change positive"> 3 new this week</div>
                </div>
                <div class="overview-card green">
                    <div class="overview-card-icon"></div>
                    <h3>Participants</h3>
                    <div class="number">48</div>
                    <div class="change positive"> 12 registered today</div>
                </div>
                <div class="overview-card orange">
                    <div class="overview-card-icon"></div>
                    <h3>Events</h3>
                    <div class="number">3</div>
                    <div class="change info">Active events</div>
                </div>
                <div class="overview-card pink">
                    <div class="overview-card-icon"></div>
                    <h3>Gallery Photos</h3>
                    <div class="number">24</div>
                    <div class="change info">Uploaded</div>
                </div>
            </div>

            <!-- Main Content Grid -->
            <div class="content-grid">
                <!-- Event Tabs Section -->
                <div class="event-tabs-container">
                    <div class="event-tabs-header">
                        <h3> Event Management</h3>
                    </div>

                    <!-- Event Selector View (shown first) -->
                    <div id="event-selector-view" class="event-selector-view">
                        <!-- Routing Config Card -->
                        <div class="routing-config-card">
                            <h4> Registration Routing</h4>

                            <!-- Custom Dropdown (Lightswind-inspired) -->
                            <div class="custom-select" id="routingDropdown">
                                <button type="button" class="select-trigger" onclick="toggleDropdown()">
                                    <span class="selected-value">
                                        <span class="icon"></span>
                                        <span id="selectedEventText">Testing (Sandbox)</span>
                                    </span>
                                    <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </button>
                                <div class="select-content">
                                    <div class="select-item selected" data-value="testing" onclick="selectOption(this)">
                                        <span class="icon"></span>
                                        <span>Testing (Sandbox)</span>
                                        <span class="check"></span>
                                    </div>
                                    <div class="select-item" data-value="promptquest" onclick="selectOption(this)">
                                        <span class="icon"></span>
                                        <span>PromptQuest</span>
                                        <span class="check"></span>
                                    </div>
                                    <div class="select-item" data-value="uibattle" onclick="selectOption(this)">
                                        <span class="icon"></span>
                                        <span>UI Battle</span>
                                        <span class="check"></span>
                                    </div>
                                    <div class="select-item" data-value="hackathon" onclick="selectOption(this)">
                                        <span class="icon"></span>
                                        <span>Hackathon</span>
                                        <span class="check"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="routing-status" id="routingStatus">
                                <span class="dot"></span>
                                <span>New registrations  <strong id="activeEventName">Testing</strong></span>
                            </div>
                        </div>

                        <!-- Event Cards Grid -->
                        <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">Select an event to
                            manage:</p>
                        <div class="event-selector-grid" id="eventSelectorGrid">
                            <div class="event-select-card" onclick="openEventView('testing')">
                                <div class="icon"></div>
                                <h4>Testing</h4>
                                <span class="count" id="testing-count"> 0 teams</span>
                            </div>
                            <div class="event-select-card" onclick="openEventView('promptquest')">
                                <div class="icon"></div>
                                <h4>PromptQuest</h4>
                                <span class="count" id="promptquest-count"> 0 teams</span>
                            </div>
                            <div class="event-select-card" onclick="openEventView('uibattle')">
                                <div class="icon"></div>
                                <h4>UI Battle</h4>
                                <span class="count" id="uibattle-count"> 0 teams</span>
                            </div>
                            <div class="event-select-card" onclick="openEventView('hackathon')">
                                <div class="icon"></div>
                                <h4>Hackathon</h4>
                                <span class="count" id="hackathon-count"> 0 teams</span>
                            </div>
                        </div>

                        <!-- Create Event Button -->
                        <div style="text-align: center; margin-top: 24px;">
                            <button class="btn btn-secondary" onclick="openCreateEventModal()"
                                style="display: inline-flex; align-items: center; gap: 8px;">
                                 Create New Event
                            </button>
                        </div>
                    </div>

                    <!-- Event Detail View (hidden by default) -->
                    <div id="event-detail-view" class="event-detail-view">
                        <button class="back-to-events" onclick="backToEventSelector()"> Back to Events</button>

                        <!-- Main Event Tabs -->
                        <div class="event-tabs">
                            <button class="event-tab active" onclick="switchEvent('testing', this)"
                                data-event="testing">
                                Testing</button>
                            <button class="event-tab" onclick="switchEvent('promptquest', this)"
                                data-event="promptquest">
                                PromptQuest</button>
                            <button class="event-tab" onclick="switchEvent('uibattle', this)" data-event="uibattle">
                                UI Battle</button>
                            <button class="event-tab" onclick="switchEvent('hackathon', this)" data-event="hackathon">
                                Hackathon</button>
                        </div>

                        <!-- Testing Content (New registrations from index.html) -->
                        <div id="testing-content" class="event-content active">
                            <div class="sub-tabs">
                                <button class="sub-tab active" onclick="switchSubTab('testing', 'reg', this)">
                                    Registration</button>
                                <button class="sub-tab" onclick="switchSubTab('testing', 'winners', this)">
                                    Winners</button>
                                <button class="sub-tab" onclick="switchSubTab('testing', 'images', this)">
                                    Images</button>
                            </div>

                            <!-- Registration Sub-content -->
                            <div id="testing-reg" class="sub-content active">
                                <div class="data-table-wrapper">
                                    <div class="data-table-header">
                                        <span class="data-table-title"> Participants</span>
                                        <div class="data-table-controls">
                                            <!-- Filter Toggle -->
                                            <button class="filter-toggle-btn" id="filterToggle-testing"
                                                onclick="toggleFilterBar('testing')">
                                                 Filter
                                            </button>
                                            <!-- Refresh Button -->
                                            <button class="table-refresh-btn" id="refreshTableBtn"
                                                onclick="refreshTableData()" title="Refresh data">
                                                <span class="refresh-icon"></span>
                                            </button>
                                            <div class="search-wrapper">
                                                <span class="search-icon"></span>
                                                <input type="text" class="table-search-input" id="testing-search"
                                                    placeholder="Search..."
                                                    onkeyup="handleTableSearch('testing', this.value)">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Filter Bar (Collapsible) -->
                                    <div class="filter-bar" id="filterBar-testing">
                                        <div class="filter-group">
                                            <label>From Date</label>
                                            <input type="date" id="filterDateFrom-testing">
                                        </div>
                                        <div class="filter-group">
                                            <label>To Date</label>
                                            <input type="date" id="filterDateTo-testing">
                                        </div>
                                        <div class="filter-group">
                                            <label>Status</label>
                                            <select id="filterStatus-testing">
                                                <option value="">All</option>
                                                <option value="pending">Pending</option>
                                                <option value="verified">Verified</option>
                                            </select>
                                        </div>
                                        <div class="filter-actions">
                                            <button class="filter-btn apply"
                                                onclick="applyFilters('testing')">Apply</button>
                                            <button class="filter-btn clear"
                                                onclick="clearFilters('testing')">Clear</button>
                                        </div>
                                    </div>

                                    <table class="data-table" id="testing-table">
                                        <thead>
                                            <tr>
                                                <th style="width: 40px;"><input type="checkbox" class="row-checkbox"
                                                        id="selectAll-testing"
                                                        onchange="toggleSelectAll('testing', this.checked)"
                                                        title="Select all"></th>
                                                <th>Team</th>
                                                <th>Team Name</th>
                                                <th>Member 1</th>
                                                <th>Member 2</th>
                                                <th>Member 3</th>
                                                <th>Email</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="testing-tbody"></tbody>
                                    </table>
                                </div>
                                <div class="pagination" id="testing-pagination"></div>
                            </div>

                            <!-- Winners Sub-content -->
                            <div id="testing-winners" class="sub-content">
                                <div class="placeholder-box">
                                    <div class="icon"></div>
                                    <h4>Winners Coming Soon!</h4>
                                    <p>Testing winners will be announced after the event.</p>
                                </div>
                            </div>

                            <!-- Images Sub-content -->
                            <div id="testing-images" class="sub-content">
                                <div class="placeholder-box">
                                    <div class="icon"></div>
                                    <h4>Event Photos Coming Soon!</h4>
                                    <p>Photos will be uploaded after the event.</p>
                                </div>
                            </div>
                        </div>

                        <!-- PromptQuest Content -->
                        <div id="promptquest-content" class="event-content">
                            <div class="sub-tabs">
                                <button class="sub-tab active" onclick="switchSubTab('promptquest', 'reg', this)">
                                    Registration</button>
                                <button class="sub-tab" onclick="switchSubTab('promptquest', 'winners', this)">
                                    Winners</button>
                                <button class="sub-tab" onclick="switchSubTab('promptquest', 'images', this)">
                                    Images</button>
                            </div>

                            <!-- Registration Sub-content -->
                            <div id="promptquest-reg" class="sub-content active">
                                <div class="data-table-wrapper">
                                    <table class="data-table" id="promptquest-table">
                                        <thead>
                                            <tr>
                                                <th>Team</th>
                                                <th>Member 1</th>
                                                <th>Member 2</th>
                                                <th>Member 3</th>
                                                <th>Email</th>
                                            </tr>
                                        </thead>
                                        <tbody id="promptquest-tbody"></tbody>
                                    </table>
                                </div>
                                <div class="pagination" id="promptquest-pagination"></div>
                            </div>

                            <!-- Winners Sub-content -->
                            <div id="promptquest-winners" class="sub-content">
                                <div class="placeholder-box">
                                    <div class="icon"></div>
                                    <h4>Winners Coming Soon!</h4>
                                    <p>PromptQuest winners will be announced after the event.</p>
                                </div>
                            </div>

                            <!-- Images Sub-content -->
                            <div id="promptquest-images" class="sub-content">
                                <div class="placeholder-box">
                                    <div class="icon"></div>
                                    <h4>Event Photos Coming Soon!</h4>
                                    <p>Photos will be uploaded after the event.</p>
                                </div>
                            </div>
                        </div>

                        <!-- UI Battle Content -->
                        <div id="uibattle-content" class="event-content">
                            <div class="sub-tabs">
                                <button class="sub-tab active" onclick="switchSubTab('uibattle', 'reg', this)">
                                    Registration</button>
                                <button class="sub-tab" onclick="switchSubTab('uibattle', 'winners', this)">
                                    Winners</button>
                                <button class="sub-tab" onclick="switchSubTab('uibattle', 'images', this)">
                                    Images</button>
                            </div>

                            <!-- Registration Sub-content -->
                            <div id="uibattle-reg" class="sub-content active">
                                <div class="data-table-wrapper">
                                    <div class="data-table-header">
                                        <span class="data-table-title"> UI Battle Participants</span>
                                        <div class="data-table-controls">
                                            <button class="table-refresh-btn" id="uibattleRefreshBtn"
                                                onclick="refreshUIBattleData()" title="Refresh data">
                                                <span class="refresh-icon"></span>
                                            </button>
                                            <div class="search-wrapper">
                                                <span class="search-icon"></span>
                                                <input type="text" class="table-search-input" id="uibattle-search"
                                                    placeholder="Search..."
                                                    onkeyup="handleTableSearch('uibattle', this.value)">
                                            </div>
                                        </div>
                                    </div>
                                    <table class="data-table" id="uibattle-table">
                                        <thead>
                                            <tr>
                                                <th>Team</th>
                                                <th>Team Name</th>
                                                <th>Member 1</th>
                                                <th>Member 2</th>
                                                <th>Member 3</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="uibattle-tbody"></tbody>
                                    </table>
                                </div>
                                <div class="pagination" id="uibattle-pagination"></div>
                            </div>

                            <!-- Winners Sub-content -->
                            <div id="uibattle-winners" class="sub-content">
                                <div class="winners-grid">
                                    <div class="winner-mini-card">
                                        <div class="medal"></div>
                                        <h4>Harini SD</h4>
                                        <p>1st Place</p>
                                    </div>
                                    <div class="winner-mini-card">
                                        <div class="medal"></div>
                                        <h4>Sinchana SD</h4>
                                        <p>2nd Place</p>
                                    </div>
                                    <div class="winner-mini-card">
                                        <div class="medal"></div>
                                        <h4>Lokesh</h4>
                                        <p>3rd Place</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Images Sub-content -->
                            <div id="uibattle-images" class="sub-content">
                                <div class="placeholder-box">
                                    <div class="icon"></div>
                                    <h4>Event Photos Coming Soon!</h4>
                                    <p>Photos will be uploaded after the event.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Hackathon Content -->
                        <div id="hackathon-content" class="event-content">
                            <div class="sub-tabs">
                                <button class="sub-tab active" onclick="switchSubTab('hackathon', 'reg', this)">
                                    Registration</button>
                                <button class="sub-tab" onclick="switchSubTab('hackathon', 'winners', this)">
                                    Winners</button>
                                <button class="sub-tab" onclick="switchSubTab('hackathon', 'images', this)">
                                    Images</button>
                            </div>

                            <div id="hackathon-reg" class="sub-content active">
                                <div class="placeholder-box">
                                    <div class="icon"></div>
                                    <h4>Coming Soon!</h4>
                                    <p>Hackathon registrations will open shortly.</p>
                                </div>
                            </div>

                            <div id="hackathon-winners" class="sub-content">
                                <div class="placeholder-box">
                                    <div class="icon"></div>
                                    <h4>Winners Coming Soon!</h4>
                                    <p>Hackathon winners will be announced after the event.</p>
                                </div>
                            </div>

                            <div id="hackathon-images" class="sub-content">
                                <div class="placeholder-box">
                                    <div class="icon"></div>
                                    <h4>Event Photos Coming Soon!</h4>
                                    <p>Photos will be uploaded after the event.</p>
                                </div>
                            </div>
                        </div>
                    </div><!-- End event-detail-view -->
                </div><!-- End event-tabs-container -->

                <!-- Sidebar -->
                <div class="sidebar">
                    <!-- Quick Actions -->
                    <div class="sidebar-card">
                        <h3> Quick Actions</h3>
                        <div class="quick-action" onclick="handleExport()">
                            <div class="quick-action-icon purple"></div>
                            <div class="quick-action-text">
                                <h4>Export Data</h4>
                                <p>Download as Excel</p>
                            </div>
                        </div>
                        <div class="quick-action" onclick="handleAddEvent()">
                            <div class="quick-action-icon green"></div>
                            <div class="quick-action-text">
                                <h4>Add Event</h4>
                                <p>Create new event</p>
                            </div>
                        </div>
                        <div class="quick-action" onclick="handleSendEmail()">
                            <div class="quick-action-icon orange"></div>
                            <div class="quick-action-text">
                                <h4>Send Emails</h4>
                                <p>Notify participants</p>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="sidebar-card">
                        <h3> Recent Activity</h3>
                        <div class="activity-item">
                            <div class="activity-dot purple"></div>
                            <div class="activity-info">
                                <h4>New registration</h4>
                                <p>Team 18 joined PromptQuest</p>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-dot green"></div>
                            <div class="activity-info">
                                <h4>Winners announced</h4>
                                <p>UI Battle results published</p>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-dot orange"></div>
                            <div class="activity-info">
                                <h4>Photos uploaded</h4>
                                <p>6 new gallery images</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== MODAL FUNCTIONS =====
        function openEditModal(teamId, teamName, m1Name, m1Detail, m2Name, m2Detail, m3Name, m3Detail, email) {
            document.getElementById('editTeamId').value = teamId;
            document.getElementById('editTeamName').value = teamName || '';
            document.getElementById('editM1Name').value = m1Name || '';
            document.getElementById('editM1Detail').value = m1Detail || '';
            document.getElementById('editM2Name').value = m2Name || '';
            document.getElementById('editM2Detail').value = m2Detail || '';
            document.getElementById('editM3Name').value = m3Name || '';
            document.getElementById('editM3Detail').value = m3Detail || '';
            document.getElementById('editEmail').value = email || '';
            document.getElementById('editModal').classList.add('active');
        }

        function openDeleteModal(teamId, teamName) {
            document.getElementById('deleteTeamId').value = teamId;
            document.getElementById('deleteTeamName').textContent = teamName;
            document.getElementById('deleteModal').classList.add('active');
        }

        // ===== EVENT NAVIGATION FUNCTIONS =====
        // Open an event's detail view
        function openEventView(eventCode) {
            // Hide the event selector
            document.getElementById('event-selector-view').classList.add('hidden');
            // Show the event detail view
            document.getElementById('event-detail-view').classList.add('active');

            // Activate the correct tab
            const tabs = document.querySelectorAll('.event-tab[data-event]');
            tabs.forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.event === eventCode) {
                    tab.classList.add('active');
                }
            });

            // Show correct content
            switchEvent(eventCode);
            console.log(`[Nav] Opened event view: ${eventCode}`);
        }

        // Go back to event selector
        function backToEventSelector() {
            // Hide event detail view
            document.getElementById('event-detail-view').classList.remove('active');
            // Show event selector
            document.getElementById('event-selector-view').classList.remove('hidden');
            console.log('[Nav] Returned to event selector');
        }

        // ===== WINNER MODAL FUNCTIONS =====
        function openWinnerModal(teamId, teamName, eventCode) {
            document.getElementById('winnerTeamId').value = teamId;
            document.getElementById('winnerTeamName').textContent = teamName;
            document.getElementById('winnerEventCode').value = eventCode;
            document.getElementById('selectedWinnerPosition').value = '';

            // Reset position button selections
            document.querySelectorAll('.winner-position-btn').forEach(btn => {
                btn.classList.remove('selected');
            });

            document.getElementById('winnerModal').classList.add('active');
        }

        function selectWinnerPosition(position, btn) {
            // Store the selected position
            document.getElementById('selectedWinnerPosition').value = position;

            // Update button visuals
            document.querySelectorAll('.winner-position-btn').forEach(b => {
                b.classList.remove('selected');
            });
            btn.classList.add('selected');
        }

        async function confirmSetWinner() {
            const teamId = document.getElementById('winnerTeamId').value;
            const position = parseInt(document.getElementById('selectedWinnerPosition').value);
            const eventCode = document.getElementById('winnerEventCode').value;

            if (!position) {
                showToast(' Please select a position');
                return;
            }

            try {
                if (window.updateInFirestore) {
                    const success = await window.updateInFirestore('registrations', teamId, {
                        isWinner: true,
                        winnerPosition: position
                    });

                    if (success) {
                        showToast(` Winner set to position ${position}!`);
                        closeModal('winnerModal');
                        // Refresh data
                        if (window.reloadFirestoreData) {
                            await window.reloadFirestoreData();
                        }
                    } else {
                        showToast(' Failed to set winner (permission denied)');
                    }
                } else {
                    showToast(' Firestore not ready');
                }
            } catch (err) {
                console.error('Set winner error:', err);
                showToast(' Error setting winner');
            }
        }

        // Remove winner status
        async function removeWinner(teamId) {
            try {
                if (window.updateInFirestore) {
                    const success = await window.updateInFirestore('registrations', teamId, {
                        isWinner: false,
                        winnerPosition: null
                    });

                    if (success) {
                        showToast(' Winner status removed');
                        if (window.reloadFirestoreData) {
                            await window.reloadFirestoreData();
                        }
                    }
                }
            } catch (err) {
                console.error('Remove winner error:', err);
            }
        }

        // ===== REGISTRATION ROUTING FUNCTIONS =====
        async function updateRegistrationRouting(eventCode) {
            const eventNames = {
                'testing': 'Testing',
                'promptquest': 'PromptQuest',
                'uibattle': 'UI Battle',
                'hackathon': 'Hackathon'
            };

            // Update UI immediately
            document.getElementById('activeEventName').textContent = eventNames[eventCode] || eventCode;

            // Save to Firestore config
            try {
                if (window.setDoc && window.doc && window.db) {
                    await window.setDoc(window.doc(window.db, 'config', 'registration'), {
                        activeEvent: eventCode,
                        updatedAt: new Date()
                    }, { merge: true });
                    showToast(` Registrations now go to ${eventNames[eventCode]}`);
                    console.log(`[Routing] Updated to: ${eventCode}`);
                }
            } catch (err) {
                console.error('Routing config error:', err);
                showToast(' Config saved locally only');
            }
        }

        async function loadRegistrationConfig() {
            try {
                if (window.getDoc && window.doc && window.db) {
                    const configDoc = await window.getDoc(window.doc(window.db, 'config', 'registration'));
                    if (configDoc.exists()) {
                        const activeEvent = configDoc.data().activeEvent || 'testing';
                        document.getElementById('activeEventSelect').value = activeEvent;
                        const eventNames = {
                            'testing': 'Testing',
                            'promptquest': 'PromptQuest',
                            'uibattle': 'UI Battle',
                            'hackathon': 'Hackathon'
                        };
                        document.getElementById('activeEventName').textContent = eventNames[activeEvent] || activeEvent;
                        console.log('[Routing] Loaded config:', activeEvent);
                    }
                }
            } catch (err) {
                console.log('[Routing] Using default config');
            }
        }

        // ===== CREATE EVENT FUNCTIONS =====
        function openCreateEventModal() {
            // Reset form
            document.getElementById('newEventName').value = '';
            document.getElementById('newEventCode').value = '';
            document.getElementById('selectedEventEmoji').value = '';

            // Reset emoji selection
            document.querySelectorAll('.emoji-option').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.dataset.emoji === '') {
                    opt.classList.add('selected');
                }
            });

            document.getElementById('createEventModal').classList.add('active');
        }

        function selectEventEmoji(emoji, btn) {
            document.getElementById('selectedEventEmoji').value = emoji;
            document.querySelectorAll('.emoji-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            btn.classList.add('selected');
        }

        async function createNewEvent() {
            const name = document.getElementById('newEventName').value.trim();
            const code = document.getElementById('newEventCode').value.trim();
            const icon = document.getElementById('selectedEventEmoji').value;

            if (!name || !code) {
                showToast(' Please fill in all fields');
                return;
            }

            // Validate code format
            if (!/^[a-z0-9_]+$/.test(code)) {
                showToast(' Code must be lowercase letters, numbers, or underscores');
                return;
            }

            try {
                // Create event metadata in Firestore
                if (window.setDoc && window.doc && window.db) {
                    await window.setDoc(window.doc(window.db, 'events', code), {
                        name: name,
                        code: code,
                        icon: icon,
                        isActive: true,
                        createdAt: new Date(),
                        registrationCount: 0
                    });

                    showToast(` Event "${name}" created!`);
                    closeModal('createEventModal');

                    // Add new event card to the grid
                    addEventCardToGrid(code, name, icon);

                    // Add to routing dropdown
                    const select = document.getElementById('activeEventSelect');
                    const option = document.createElement('option');
                    option.value = code;
                    option.textContent = `${icon} ${name}`;
                    select.appendChild(option);

                    console.log(`[Events] Created: ${code}`);
                } else {
                    showToast(' Firestore not ready');
                }
            } catch (err) {
                console.error('Create event error:', err);
                showToast(' Error creating event');
            }
        }

        function addEventCardToGrid(code, name, icon) {
            const grid = document.getElementById('eventSelectorGrid');
            const card = document.createElement('div');
            card.className = 'event-select-card';
            card.setAttribute('onclick', `openEventView('${code}')`);
            card.innerHTML = `
                <div class="icon">${icon}</div>
                <h4>${name}</h4>
                <span class="count" id="${code}-count"> 0 teams</span>
            `;
            grid.appendChild(card);
        }

        // Update handleAddEvent to open modal
        function handleAddEvent() {
            openCreateEventModal();
        }

        // ===== STATUS TOGGLE =====
        async function toggleStatus(teamId, currentStatus) {
            const newStatus = currentStatus === 'Verified' ? 'Pending' : 'Verified';

            try {
                // Update in Firestore using global helper (defined in module)
                if (window.updateInFirestore) {
                    const success = await window.updateInFirestore('registrations', teamId, { status: newStatus });
                    if (!success) {
                        throw new Error('Firestore update returned false');
                    }
                } else {
                    console.error('updateInFirestore not available yet');
                    showToast(' Please wait for page to fully load');
                    return;
                }

                // Update the UI immediately
                const row = document.querySelector(`tr[data-team="${teamId}"]`);
                console.log('[toggleStatus] Looking for row with data-team:', teamId, 'Found:', row);
                if (row) {
                    const statusPill = row.querySelector('.status-pill');
                    console.log('[toggleStatus] Status pill found:', statusPill);
                    if (statusPill) {
                        statusPill.textContent = newStatus;
                        statusPill.className = `status-pill clickable ${newStatus.toLowerCase()}`;
                        statusPill.setAttribute('onclick', `toggleStatus('${teamId}', '${newStatus}')`);
                    }
                    // Update verify button title
                    const verifyBtn = row.querySelector('.action-btn.verify');
                    if (verifyBtn) {
                        verifyBtn.title = newStatus === 'Verified' ? 'Mark as Pending' : 'Mark as Verified';
                        verifyBtn.setAttribute('onclick', `toggleStatus('${teamId}', '${newStatus}')`);
                    }
                } else {
                    console.warn('[toggleStatus] Row not found! Available rows:',
                        [...document.querySelectorAll('tr[data-team]')].map(r => r.dataset.team));
                }

                showToast(` Status changed to ${newStatus}`);
            } catch (err) {
                console.error('Status update failed:', err);
                showToast(' Failed to update status (check permissions)');
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        async function saveEdit() {
            const teamId = document.getElementById('editTeamId').value;
            const data = {
                teamName: document.getElementById('editTeamName').value,
                member1Name: document.getElementById('editM1Name').value,
                member1Detail: document.getElementById('editM1Detail').value,
                member2Name: document.getElementById('editM2Name').value,
                member2Detail: document.getElementById('editM2Detail').value,
                member3Name: document.getElementById('editM3Name').value,
                member3Detail: document.getElementById('editM3Detail').value,
                email: document.getElementById('editEmail').value,
            };

            // Try to update in Firestore
            if (window.updateInFirestore) {
                const success = await window.updateInFirestore('registrations', teamId, data);
                if (success) {
                    showToast(' Team updated in database!');
                } else {
                    showToast(' Updated locally (Firebase permission denied)');
                }
            } else {
                console.log('Saving locally:', { teamId, ...data });
                showToast(' Team updated (local only)');
            }

            closeModal('editModal');
        }

        async function confirmDelete() {
            const teamId = document.getElementById('deleteTeamId').value;
            const teamName = document.getElementById('deleteTeamName')?.textContent || 'Team';

            closeModal('deleteModal');

            // Soft delete with undo capability
            if (window.deleteFromFirestore) {
                const result = await window.deleteFromFirestore('registrations', teamId, teamName);
                if (result.success) {
                    // Show undo toast for 30 seconds
                    const toast = document.getElementById('toast');
                    toast.innerHTML = ` Deleted "${teamName}" <button onclick="handleUndoDelete('${teamId}')" style="margin-left: 12px; padding: 4px 12px; background: #fff; color: #000; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">UNDO</button>`;
                    toast.classList.add('show');

                    // Auto-hide after 30 seconds
                    setTimeout(() => {
                        toast.classList.remove('show');
                        toast.innerHTML = 'Action completed!';
                    }, 30000);
                } else {
                    showToast(' Delete failed (Firebase permission denied)');
                }
            } else {
                showToast(' Team removed (local only)');
            }

            // Remove row from DOM
            const row = document.querySelector(`tr[data-team="${teamId}"]`);
            if (row) row.remove();
        }

        // Handle undo delete from toast
        async function handleUndoDelete(teamId) {
            const toast = document.getElementById('toast');
            toast.classList.remove('show');

            if (window.undoDelete) {
                const success = await window.undoDelete(teamId);
                if (success) {
                    showToast(' Team restored successfully!');
                    // Refresh the table to show restored team
                    if (window.reloadFirestoreData) {
                        window.reloadFirestoreData();
                    }
                } else {
                    showToast(' Could not restore team');
                }
            }
        }
        window.handleUndoDelete = handleUndoDelete;

        // ===== BULK SELECTION FUNCTIONS =====
        function toggleSelectAll(eventName, checked) {
            const checkboxes = document.querySelectorAll(`#${eventName}-tbody .row-checkbox`);
            checkboxes.forEach(cb => cb.checked = checked);
            updateBulkActionBar();
        }
        window.toggleSelectAll = toggleSelectAll;

        function toggleRowSelection(checkbox) {
            updateBulkActionBar();
        }
        window.toggleRowSelection = toggleRowSelection;

        function updateBulkActionBar() {
            const selected = document.querySelectorAll('.row-checkbox:checked:not([id^="selectAll"])');
            const count = selected.length;
            const bar = document.getElementById('bulkActionBar');
            const countEl = document.getElementById('bulkCount');

            if (count > 0) {
                bar.classList.add('active');
                countEl.textContent = `${count} selected`;
            } else {
                bar.classList.remove('active');
            }
        }

        async function bulkUpdateStatus(newStatus) {
            const selected = document.querySelectorAll('.row-checkbox:checked:not([id^="selectAll"])');
            const count = selected.length;

            if (count === 0) {
                showToast('No teams selected');
                return;
            }

            if (!confirm(`Update ${count} team(s) to "${newStatus}"?`)) return;

            let successCount = 0;
            for (const checkbox of selected) {
                const teamId = checkbox.dataset.teamId;
                if (teamId && window.updateInFirestore) {
                    const success = await window.updateInFirestore('registrations', teamId, { status: newStatus });
                    if (success) successCount++;
                }
            }

            await window.logAdminAction('BULK_STATUS_UPDATE', { count: successCount, newStatus });
            showToast(` Updated ${successCount} team(s) to ${newStatus}`);
            clearBulkSelection();
            if (window.reloadFirestoreData) window.reloadFirestoreData();
        }
        window.bulkUpdateStatus = bulkUpdateStatus;

        async function bulkDeleteSelected() {
            const selected = document.querySelectorAll('.row-checkbox:checked:not([id^="selectAll"])');
            const count = selected.length;

            if (count === 0) {
                showToast('No teams selected');
                return;
            }

            if (!confirm(`Delete ${count} team(s)? (Can be undone from trash)`)) return;

            let successCount = 0;
            for (const checkbox of selected) {
                const teamId = checkbox.dataset.teamId;
                if (teamId && window.deleteFromFirestore) {
                    const result = await window.deleteFromFirestore('registrations', teamId);
                    if (result.success) successCount++;
                }
            }

            await window.logAdminAction('BULK_DELETE', { count: successCount });
            showToast(` Deleted ${successCount} team(s) - check trash to restore`);
            clearBulkSelection();
            if (window.reloadFirestoreData) window.reloadFirestoreData();
        }
        window.bulkDeleteSelected = bulkDeleteSelected;

        function clearBulkSelection() {
            document.querySelectorAll('.row-checkbox').forEach(cb => cb.checked = false);
            document.getElementById('bulkActionBar').classList.remove('active');
        }
        window.clearBulkSelection = clearBulkSelection;

        // ===== FILTER BAR FUNCTIONS =====
        function toggleFilterBar(eventName) {
            const filterBar = document.getElementById(`filterBar-${eventName}`);
            const toggleBtn = document.getElementById(`filterToggle-${eventName}`);

            if (filterBar.classList.contains('active')) {
                filterBar.classList.remove('active');
                toggleBtn.classList.remove('active');
                toggleBtn.innerHTML = ' Filter';
            } else {
                filterBar.classList.add('active');
                toggleBtn.classList.add('active');
                toggleBtn.innerHTML = ' Filter';
            }
        }
        window.toggleFilterBar = toggleFilterBar;

        async function applyFilters(eventName) {
            const dateFrom = document.getElementById(`filterDateFrom-${eventName}`).value;
            const dateTo = document.getElementById(`filterDateTo-${eventName}`).value;
            const status = document.getElementById(`filterStatus-${eventName}`).value.toLowerCase();

            const tbody = document.getElementById(`${eventName}-tbody`);
            const rows = tbody.querySelectorAll('tr');

            let visibleCount = 0;
            rows.forEach(row => {
                const statusCell = row.querySelector('.status-pill');
                const rowStatus = statusCell ? statusCell.textContent.toLowerCase().trim() : '';

                let showRow = true;

                // Status filter
                if (status && rowStatus !== status) {
                    showRow = false;
                }

                // Date filter would require date data in rows - for now just filter by status

                row.style.display = showRow ? '' : 'none';
                if (showRow) visibleCount++;
            });

            showToast(` Showing ${visibleCount} of ${rows.length} teams`);
            await window.logAdminAction('FILTER_APPLIED', { eventName, status, dateFrom, dateTo });
        }
        window.applyFilters = applyFilters;

        function clearFilters(eventName) {
            document.getElementById(`filterDateFrom-${eventName}`).value = '';
            document.getElementById(`filterDateTo-${eventName}`).value = '';
            document.getElementById(`filterStatus-${eventName}`).value = '';

            const tbody = document.getElementById(`${eventName}-tbody`);
            const rows = tbody.querySelectorAll('tr');
            rows.forEach(row => row.style.display = '');

            showToast('Filters cleared');
        }
        window.clearFilters = clearFilters;

        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.classList.remove('active');
            }
        });

        // ACCESSIBILITY: Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                    modal.classList.remove('active');
                });
                // Also close custom dropdowns
                document.querySelectorAll('.custom-select.open').forEach(dropdown => {
                    dropdown.classList.remove('open');
                });
            }
        });

        // ===== CUSTOM DROPDOWN FUNCTIONS =====
        function toggleDropdown() {
            const dropdown = document.getElementById('routingDropdown');
            dropdown.classList.toggle('open');
        }

        function selectOption(item) {
            const dropdown = document.getElementById('routingDropdown');
            const value = item.dataset.value;
            const icon = item.querySelector('.icon').textContent;
            const text = item.querySelector('span:nth-child(2)').textContent;

            // Update selected state
            dropdown.querySelectorAll('.select-item').forEach(i => i.classList.remove('selected'));
            item.classList.add('selected');

            // Update trigger display
            document.querySelector('.select-trigger .icon').textContent = icon;
            document.getElementById('selectedEventText').textContent = text;

            // Update routing status
            document.getElementById('activeEventName').textContent = text.split(' ')[0]; // First word

            // Close dropdown
            dropdown.classList.remove('open');

            // Call the routing update function
            updateRegistrationRouting(value);
        }

        async function updateRegistrationRouting(eventCode) {
            try {
                if (window.updateInFirestore) {
                    await window.updateInFirestore('config', 'registration', { activeEvent: eventCode });
                    showToast(' Registration routing updated!');
                } else {
                    showToast(' Routing updated (local only)');
                }
            } catch (error) {
                console.error('Failed to update routing:', error);
                showToast(' Failed to update routing');
            }
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('routingDropdown');
            if (dropdown && !dropdown.contains(e.target)) {
                dropdown.classList.remove('open');
            }
        });

        // PromptQuest Data - Loaded from Firestore
        let promptquestData = [];
        let isLoading = true;

        const rowsPerPage = 5;
        let currentPage = 1;

        function renderTable(page) {
            const tbody = document.getElementById('promptquest-tbody');
            const start = (page - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const pageData = promptquestData.slice(start, end);

            tbody.innerHTML = pageData.map(row => `
        <tr>
          <td><span class="team-badge">${row.team}</span></td>
          <td><div class="member-info"><span class="name">${row.m1.name}</span><span class="detail">${row.m1.detail}</span></div></td>
          <td><div class="member-info"><span class="name">${row.m2.name}</span><span class="detail">${row.m2.detail}</span></div></td>
          <td><div class="member-info"><span class="name">${row.m3.name}</span><span class="detail">${row.m3.detail}</span></div></td>
          <td><a href="mailto:${row.email}" class="email-link">${row.email}</a></td>
        </tr>
      `).join('');

            renderPagination();
        }

        function renderPagination() {
            const totalPages = Math.ceil(promptquestData.length / rowsPerPage);
            const container = document.getElementById('promptquest-pagination');

            let html = `<button class="page-btn" onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}></button>`;

            for (let i = 1; i <= totalPages; i++) {
                html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
            }

            html += `<span class="page-info">${currentPage} of ${totalPages}</span>`;
            html += `<button class="page-btn" onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}></button>`;

            container.innerHTML = html;
        }

        function goToPage(page) {
            const totalPages = Math.ceil(promptquestData.length / rowsPerPage);
            if (page < 1 || page > totalPages) return;
            currentPage = page;
            renderTable(currentPage);
        }

        // Navigation
        function toggleNav() {
            const navLinks = document.getElementById("navLinks");
            const hamburger = document.getElementById("hamburger");
            navLinks.classList.toggle("active");
            hamburger.classList.toggle("active");
        }

        document.addEventListener("click", function (event) {
            const navLinks = document.getElementById("navLinks");
            const hamburger = document.getElementById("hamburger");
            const navbar = document.getElementById("navbar");
            if (!navbar.contains(event.target) && navLinks.classList.contains("active")) {
                navLinks.classList.remove("active");
                hamburger.classList.remove("active");
            }
        });

        function handleLogout() {
            document.getElementById("login-page").style.display = "flex";
            document.getElementById("admin-dashboard").classList.remove("active");
            document.getElementById("loginForm").reset();
        }

        // Event Tabs
        function switchEvent(eventName, btn) {
            document.querySelectorAll(".event-tab").forEach(tab => tab.classList.remove("active"));
            document.querySelectorAll(".event-content").forEach(content => content.classList.remove("active"));

            // Handle case when btn is not provided (called from openEventView)
            if (btn) {
                btn.classList.add("active");
            } else {
                // Find the tab that matches the eventName
                const targetTab = document.querySelector(`.event-tab[data-event="${eventName}"]`);
                if (targetTab) targetTab.classList.add("active");
            }

            const content = document.getElementById(eventName + "-content");
            if (content) content.classList.add("active");
        }

        // Sub Tabs
        function switchSubTab(eventName, subName, btn) {
            const parent = document.getElementById(eventName + "-content");
            parent.querySelectorAll(".sub-tab").forEach(tab => tab.classList.remove("active"));
            parent.querySelectorAll(".sub-content").forEach(content => content.classList.remove("active"));
            btn.classList.add("active");
            document.getElementById(eventName + "-" + subName).classList.add("active");
        }

        // Toast
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // Quick Actions - REAL EXPORT
        function handleExport() {
            showToast(' Generating Excel file...');

            // Prepare data for export
            const exportData = promptquestData.map(row => ({
                'Team #': row.team,
                'Member 1 Name': row.m1.name,
                'Member 1 Details': row.m1.detail,
                'Member 2 Name': row.m2.name,
                'Member 2 Details': row.m2.detail,
                'Member 3 Name': row.m3.name,
                'Member 3 Details': row.m3.detail,
                'Email': row.email
            }));

            // Create worksheet
            const ws = XLSX.utils.json_to_sheet(exportData);

            // Set column widths
            ws['!cols'] = [
                { wch: 8 },  // Team #
                { wch: 18 }, // Member 1 Name
                { wch: 15 }, // Member 1 Details
                { wch: 18 }, // Member 2 Name
                { wch: 15 }, // Member 2 Details
                { wch: 18 }, // Member 3 Name
                { wch: 15 }, // Member 3 Details
                { wch: 30 }  // Email
            ];

            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'PromptQuest Registrations');

            // Generate filename with date
            const date = new Date().toISOString().split('T')[0];
            const filename = `PromptQuest_Registrations_${date}.xlsx`;

            // Download
            XLSX.writeFile(wb, filename);

            setTimeout(() => showToast(' Excel file downloaded!'), 1000);
        }

        function handleAddEvent() {
            showToast(' Add Event feature coming soon!');
        }

        function handleSendEmail() {
            // Open mailto with all participant emails
            const emails = promptquestData.map(row => row.email).join(',');
            const subject = encodeURIComponent('ISTE PromptQuest Update');
            const body = encodeURIComponent('Dear Participants,\n\nThank you for registering for PromptQuest!\n\nBest regards,\nISTE Team');
            window.open(`mailto:${emails}?subject=${subject}&body=${body}`);
            showToast(' Opening email client...');
        }

        // --- TABLE SEARCH ---
        let searchTimeouts = {};
        function handleTableSearch(tableId, query) {
            clearTimeout(searchTimeouts[tableId]);
            searchTimeouts[tableId] = setTimeout(() => {
                const tbody = document.getElementById(tableId + '-tbody');
                if (!tbody) return;

                const rows = tbody.querySelectorAll('tr');
                const q = query.toLowerCase().trim();

                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(q) ? '' : 'none';
                });
            }, 300);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderTable(1);
        });

        /**
         * Refresh Table Data (Lightswind-style: data only, no page reload)
         * Called by the refresh button in the table header
         */
        function refreshTableData() {
            const btn = document.getElementById('refreshTableBtn');
            if (!btn) return;

            // Add spinning animation
            btn.classList.add('spinning');
            btn.disabled = true;

            // This will be called from the Firebase module after it loads
            if (window.reloadFirestoreData) {
                window.reloadFirestoreData().finally(() => {
                    btn.classList.remove('spinning');
                    btn.disabled = false;
                    showToast(' Data refreshed!');
                });
            } else {
                // Fallback: just show toast after short delay
                setTimeout(() => {
                    btn.classList.remove('spinning');
                    btn.disabled = false;
                    showToast(' Data reload function not available');
                }, 800);
            }
        }

        /**
         * Toggle Password Visibility
         * Shows/hides the password and swaps eye icons
         */
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('password');
            const toggleBtn = document.getElementById('passwordToggle');
            const eyeOpen = toggleBtn.querySelector('.eye-open');
            const eyeClosed = toggleBtn.querySelector('.eye-closed');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeOpen.style.display = 'none';
                eyeClosed.style.display = 'block';
            } else {
                passwordInput.type = 'password';
                eyeOpen.style.display = 'block';
                eyeClosed.style.display = 'none';
            }
        }
    </script>

    <!-- SheetJS Library for Excel Export (FREE) -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <!-- Firebase Authentication & Firestore -->
    <!-- SECURITY: Firebase config loaded from external file (config.js is gitignored) -->
    <script src="security.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
        import { getFirestore, collection, getDocs, doc, deleteDoc, updateDoc, setDoc, getDoc, orderBy, query, where, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

        /**
         * SECURITY: Firebase Configuration
         * 
         * NOTE: Firebase API keys are designed to be public for client-side apps.
         * Security is enforced through:
         * 1. Firebase Security Rules (server-side)
         * 2. Authentication requirements
         * 3. API key restrictions in Google Cloud Console
         * 
         * For production, restrict the API key to specific domains:
         * - https://syed-furqanahmed.github.io/*
         * - http://127.0.0.1:5500/* (local testing)
         * 
         * @see https://firebase.google.com/docs/projects/api-keys
         */
        const firebaseConfig = {
            apiKey: "AIzaSyAf1JlNjAsUGib1PpZWF6xELseRERpLE48",
            authDomain: "iste-toce.firebaseapp.com",
            projectId: "iste-toce",
            storageBucket: "iste-toce.firebasestorage.app",
            messagingSenderId: "918228043244",
            appId: "1:918228043244:web:891b81cc0a80127588ecc9",
            measurementId: "G-RWG0BCFGEJ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ===== SECURITY: Initialize login rate limiter =====
        // Note: Rate limit status shown only after failed login attempt
        let loginRateLimiter = null;
        if (window.RateLimiter && window.SECURITY_CONFIG) {
            loginRateLimiter = new window.RateLimiter({
                ...window.SECURITY_CONFIG.rateLimiting.login,
                name: 'admin_login'
            });
            console.log('[Security] Admin login rate limiter initialized');
        }

        // ===== SESSION TIMEOUT (30 min auto-logout) =====
        let inactivityTimer;
        const SESSION_TIMEOUT_MS = 30 * 60 * 1000; // 30 minutes

        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            if (auth.currentUser) {
                inactivityTimer = setTimeout(() => {
                    console.log('[Security] Session timeout - auto logout');
                    signOut(auth).then(() => {
                        showToast('Session expired - please login again');
                    });
                }, SESSION_TIMEOUT_MS);
            }
        }

        // Attach activity listeners
        ['click', 'keypress', 'scroll', 'mousemove'].forEach(event => {
            document.addEventListener(event, resetInactivityTimer, { passive: true });
        });

        // ===== AUDIT LOGGING SYSTEM =====
        async function logAdminAction(action, details = {}) {
            try {
                const userEmail = auth.currentUser?.email || 'unknown';
                await addDoc(collection(db, 'auditLogs'), {
                    action: action,
                    details: details,
                    adminEmail: userEmail,
                    timestamp: serverTimestamp(),
                    userAgent: navigator.userAgent
                });
                console.log(`[Audit] ${action}:`, details);
            } catch (error) {
                console.warn('[Audit] Failed to log action:', error);
            }
        }
        window.logAdminAction = logAdminAction;

        // ===== EXPOSE FIRESTORE OPERATIONS TO WINDOW =====
        // Soft Delete - moves to trash collection with undo capability
        window.deleteFromFirestore = async function (collectionPath, docId, teamName = 'Unknown') {
            try {
                const docRef = doc(db, collectionPath, docId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const teamData = docSnap.data();

                    // Move to trash collection
                    await setDoc(doc(db, 'trash', docId), {
                        ...teamData,
                        originalCollection: collectionPath,
                        deletedAt: serverTimestamp(),
                        deletedBy: auth.currentUser?.email || 'unknown'
                    });

                    // Remove from original collection
                    await deleteDoc(docRef);

                    // Log the action
                    await logAdminAction('SOFT_DELETE', {
                        teamId: docId,
                        teamName: teamData.teamName || teamName,
                        collection: collectionPath
                    });

                    console.log(` Soft deleted: ${docId}`);
                    return { success: true, deletedData: teamData };
                }
                return { success: false };
            } catch (error) {
                console.error(' Error soft deleting:', error);
                return { success: false, error };
            }
        };

        // Undo delete - restore from trash
        window.undoDelete = async function (docId) {
            try {
                const trashRef = doc(db, 'trash', docId);
                const trashSnap = await getDoc(trashRef);

                if (trashSnap.exists()) {
                    const data = trashSnap.data();
                    const originalCollection = data.originalCollection || 'registrations';

                    // Remove trash metadata
                    delete data.originalCollection;
                    delete data.deletedAt;
                    delete data.deletedBy;

                    // Restore to original collection
                    await setDoc(doc(db, originalCollection, docId), data);

                    // Remove from trash
                    await deleteDoc(trashRef);

                    await logAdminAction('UNDO_DELETE', { teamId: docId });
                    console.log(` Restored: ${docId}`);
                    return true;
                }
                return false;
            } catch (error) {
                console.error(' Error restoring:', error);
                return false;
            }
        };

        // Update a registration in Firestore (with audit logging)
        window.updateInFirestore = async function (collectionPath, docId, data) {
            try {
                const docRef = doc(db, collectionPath, docId);
                const beforeSnap = await getDoc(docRef);
                const beforeData = beforeSnap.exists() ? beforeSnap.data() : {};

                await updateDoc(docRef, data);

                // Log the action with before/after
                await logAdminAction('UPDATE', {
                    teamId: docId,
                    changes: Object.keys(data),
                    collection: collectionPath
                });

                console.log(` Updated document: ${docId}`);
                return true;
            } catch (error) {
                console.error(' Error updating Firestore:', error);
                return false;
            }
        };

        // ===== EXPOSE ADDITIONAL FIRESTORE FUNCTIONS FOR ROUTING/EVENTS =====
        window.db = db;
        window.doc = doc;
        window.setDoc = setDoc;
        window.getDoc = getDoc;

        // Load data from Firestore
        async function loadFromFirestore() {
            try {
                console.log(' Loading data from Firestore...');
                const teamsRef = collection(db, 'registrations', 'promptquest', 'teams');
                const q = query(teamsRef, orderBy('teamNumber'));
                const snapshot = await getDocs(q);

                const data = [];
                snapshot.forEach(doc => {
                    const d = doc.data();
                    data.push({
                        team: d.teamNumber || 0,
                        m1: { name: d.member1Name || '', detail: d.member1Detail || '' },
                        m2: { name: d.member2Name || '', detail: d.member2Detail || '' },
                        m3: { name: d.member3Name || '', detail: d.member3Detail || '' },
                        email: d.email || ''
                    });
                });

                // Sort by team number
                data.sort((a, b) => a.team - b.team);

                console.log(` Loaded ${data.length} teams from Firestore`);
                return data;
            } catch (error) {
                console.error(' Error loading from Firestore:', error);
                showToast(' Error loading data from cloud');
                return [];
            }
        }

        // Load Testing registrations (from index.html form)
        async function loadTestingData() {
            try {
                console.log(' Loading Testing registrations...');
                // Filter to show only Testing registrations (not UI Battle or other events)
                const regsRef = collection(db, 'registrations');
                const q = query(regsRef, where('event', '==', 'testing'), orderBy('registeredAt', 'desc'));
                const snapshot = await getDocs(q);

                // Expose count for event selector
                window.testingDataCount = snapshot.size;

                const tbody = document.getElementById('testing-tbody');
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;padding:40px;color:var(--text-muted);">No test registrations yet</td></tr>';
                    return;
                }
                tbody.innerHTML = '';
                let i = 1;
                snapshot.forEach(doc => {
                    const d = doc.data();
                    const docId = doc.id;

                    // Winner badge HTML
                    const winnerBadge = d.isWinner ?
                        `<span class="winner-badge ${d.winnerPosition === 1 ? 'gold' : d.winnerPosition === 2 ? 'silver' : 'bronze'}"> ${d.winnerPosition === 1 ? '1st' : d.winnerPosition === 2 ? '2nd' : '3rd'}</span>` : '';

                    // Winner button - shows remove option if already winner
                    const winnerBtn = d.isWinner ?
                        `<button class="action-btn winner" title="Remove Winner Status" onclick="removeWinner('${docId}')"></button>` :
                        `<button class="action-btn winner" title="Set as Winner" onclick="openWinnerModal('${docId}', '${(d.teamName || 'Team').replace(/'/g, "\\'")}', 'testing')"></button>`;

                    tbody.innerHTML += `
                        <tr data-team="${docId}">
                            <td><input type="checkbox" class="row-checkbox" data-team-id="${docId}" onchange="toggleRowSelection(this)"></td>
                            <td><span class="team-badge">${i++}</span></td>
                            <td><strong>${d.teamName || ''}</strong>${winnerBadge}</td>
                            <td><div class="member-info"><span class="name">${d.member1?.name || '-'}</span><span class="detail">${d.member1?.usn || ''}  ${d.member1?.dept || ''}</span></div></td>
                            <td><div class="member-info"><span class="name">${d.member2?.name || '-'}</span><span class="detail">${d.member2?.usn || ''}  ${d.member2?.dept || ''}</span></div></td>
                            <td><div class="member-info"><span class="name">${d.member3?.name || '-'}</span><span class="detail">${d.member3?.usn || ''}  ${d.member3?.dept || ''}</span></div></td>
                            <td><a href="mailto:${d.email}" class="email-link">${d.email}</a></td>
                            <td><span class="status-pill clickable ${(d.status || 'Pending').toLowerCase()}" onclick="toggleStatus('${docId}', '${d.status || 'Pending'}')" title="Click to toggle status">${d.status || 'Pending'}</span></td>
                            <td>
                                <div class="action-buttons">
                                    ${winnerBtn}
                                    <button class="action-btn verify" title="${(d.status || 'Pending') === 'Verified' ? 'Mark as Pending' : 'Mark as Verified'}" onclick="toggleStatus('${docId}', '${d.status || 'Pending'}')"></button>
                                    <button class="action-btn edit" title="Edit" onclick="openEditModal('${docId}', '${(d.teamName || '').replace(/'/g, "\\'")}', '${(d.member1?.name || '').replace(/'/g, "\\'")}', '${d.member1?.usn || ''}  ${d.member1?.dept || ''}', '${(d.member2?.name || '').replace(/'/g, "\\'")}', '${d.member2?.usn || ''}  ${d.member2?.dept || ''}', '${(d.member3?.name || '').replace(/'/g, "\\'")}', '${d.member3?.usn || ''}  ${d.member3?.dept || ''}', '${d.email}')"></button>
                                    <button class="action-btn delete" title="Delete" onclick="openDeleteModal('${docId}', '${(d.teamName || 'Team ' + i).replace(/'/g, "\\'")}')"></button>
                                </div>
                            </td>
                        </tr>`;
                });
                console.log(` Loaded ${snapshot.size} testing registrations`);
            } catch (err) {
                console.error(' Error loading testing data:', err);
                // Fallback to mock data for demonstration
                const tbody = document.getElementById('testing-tbody');
                if (tbody) {
                    const mockData = [];
                    tbody.innerHTML = mockData.map(d => `
                < tr data - team="${d.team}" >
                            <td><span class="team-badge">${d.team}</span></td>
                            <td><strong>${d.teamName}</strong></td>
                            <td><div class="member-info"><span class="name">${d.m1}</span><span class="detail">${d.m1d}</span></div></td>
                            <td><div class="member-info"><span class="name">${d.m2}</span><span class="detail">${d.m2d}</span></div></td>
                            <td><div class="member-info"><span class="name">${d.m3}</span><span class="detail">${d.m3d}</span></div></td>
                            <td><a href="mailto:${d.email}" class="email-link">${d.email}</a></td>
                            <td><span class="status-pill clickable ${d.status.toLowerCase()}" onclick="toggleStatus('${d.team}', '${d.status}')" title="Click to toggle status">${d.status}</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button class="action-btn verify" title="${d.status === 'Verified' ? 'Mark as Pending' : 'Mark as Verified'}" onclick="toggleStatus('${d.team}', '${d.status}')"></button>
                                    <button class="action-btn edit" title="Edit" onclick="openEditModal('${d.team}', '${d.teamName}', '${d.m1}', '${d.m1d}', '${d.m2}', '${d.m2d}', '${d.m3}', '${d.m3d}', '${d.email}')"></button>
                                    <button class="action-btn delete" title="Delete" onclick="openDeleteModal('${d.team}', '${d.teamName}')"></button>
                                </div>
                            </td>
                        </tr >
                `).join('');
                    console.log(' Loaded fallback mock data (Firestore permission denied)');
                }
            }
        }

        // ===== LOAD UI BATTLE DATA =====
        async function loadUIBattleData() {
            try {
                console.log(' Loading UI Battle registrations...');
                // Query registrations collection where event = 'uibattle'
                const regsRef = collection(db, 'registrations');
                const q = query(regsRef, where('event', '==', 'uibattle'), orderBy('registeredAt', 'desc'));
                const snapshot = await getDocs(q);

                const tbody = document.getElementById('uibattle-tbody');
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:40px;color:var(--text-muted);">No UI Battle registrations yet</td></tr>';
                    console.log(' No UI Battle registrations found');
                    return;
                }

                let i = 1;
                tbody.innerHTML = '';
                snapshot.forEach(docSnap => {
                    const d = docSnap.data();
                    const docId = docSnap.id;
                    tbody.innerHTML += `
                < tr data - team="${docId}" >
                            <td><span class="team-badge">${i++}</span></td>
                            <td><strong>${d.teamName || ''}</strong></td>
                            <td><div class="member-info"><span class="name">${d.member1?.name || '-'}</span><span class="detail">${d.member1?.usn || ''}  ${d.member1?.dept || ''}</span></div></td>
                            <td><div class="member-info"><span class="name">${d.member2?.name || '-'}</span><span class="detail">${d.member2?.usn || ''}  ${d.member2?.dept || ''}</span></div></td>
                            <td><div class="member-info"><span class="name">${d.member3?.name || '-'}</span><span class="detail">${d.member3?.usn || ''}  ${d.member3?.dept || ''}</span></div></td>
                            <td><span class="status-pill clickable ${(d.status || 'Pending').toLowerCase()}" onclick="toggleUIBattleStatus('${docId}', '${d.status || 'Pending'}')" title="Click to toggle status">${d.status || 'Pending'}</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button class="action-btn verify" title="${(d.status || 'Pending') === 'Verified' ? 'Mark as Pending' : 'Mark as Verified'}" onclick="toggleUIBattleStatus('${docId}', '${d.status || 'Pending'}')"></button>
                                    <button class="action-btn delete" title="Delete" onclick="openDeleteUIBattleModal('${docId}', '${(d.teamName || 'Team ' + i).replace(/'/g, "\\'")}')"></button>
                                </div>
                            </td >
                        </tr > `;
                });
                console.log(` Loaded ${snapshot.size} UI Battle registrations`);
            } catch (err) {
                console.error(' Error loading UI Battle data:', err);
                const tbody = document.getElementById('uibattle-tbody');
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:40px;color:var(--accent-warning);"> Error loading data (check Firestore permissions or create index)</td></tr>';
                }
            }
        }

        // Refresh UI Battle data
        window.refreshUIBattleData = async function () {
            const btn = document.getElementById('uibattleRefreshBtn');
            if (btn) btn.classList.add('spinning');
            await loadUIBattleData();
            if (btn) btn.classList.remove('spinning');
            showToast(' UI Battle data refreshed!');
        };

        // Toggle status for UI Battle registrations
        async function toggleUIBattleStatus(docId, currentStatus) {
            const newStatus = currentStatus === 'Verified' ? 'Pending' : 'Verified';
            try {
                if (window.updateInFirestore) {
                    // Use registrations collection (same as other events, differentiated by 'event' field)
                    const success = await window.updateInFirestore('registrations', docId, { status: newStatus });
                    if (success) {
                        const row = document.querySelector(`tr[data - team= "${docId}"]`);
                        if (row) {
                            const statusPill = row.querySelector('.status-pill');
                            if (statusPill) {
                                statusPill.textContent = newStatus;
                                statusPill.className = `status - pill clickable ${newStatus.toLowerCase()} `;
                                statusPill.setAttribute('onclick', `toggleUIBattleStatus('${docId}', '${newStatus}')`);
                            }
                        }
                        showToast(` Status changed to ${newStatus} `);
                    }
                }
            } catch (err) {
                console.error('Status update failed:', err);
                showToast(' Failed to update status');
            }
        }

        // Delete modal for UI Battle (uses same registrations collection)
        function openDeleteUIBattleModal(docId, name) {
            document.getElementById('deleteTeamId').value = docId;
            document.getElementById('deleteTeamName').textContent = name;
            // Uses registrations collection (same as Testing)
            window.deleteFromCollection = 'registrations';
            document.getElementById('deleteModal').classList.add('active');
        }

        // ===== EXPOSE UI BATTLE FUNCTIONS GLOBALLY =====
        window.toggleUIBattleStatus = toggleUIBattleStatus;
        window.openDeleteUIBattleModal = openDeleteUIBattleModal;

        // Initialize data on page load
        window.addEventListener('DOMContentLoaded', async () => {
            // Load Firestore data
            promptquestData = await loadFromFirestore();
            isLoading = false;

            // Load Testing data
            await loadTestingData();

            // Load UI Battle data
            await loadUIBattleData();

            // Load registration routing config
            if (typeof loadRegistrationConfig === 'function') {
                await loadRegistrationConfig();
            }

            // Update stats
            document.querySelector('.overview-card.purple .number').textContent = promptquestData.length;
            document.querySelector('.overview-card.green .number').textContent = promptquestData.length * 3;

            // Update event selector counts
            const testingCount = document.getElementById('testing-count');
            const promptquestCount = document.getElementById('promptquest-count');
            const uibattleCount = document.getElementById('uibattle-count');

            if (testingCount) testingCount.textContent = ` ${window.testingDataCount || 0} teams`;
            if (promptquestCount) promptquestCount.textContent = ` ${promptquestData.length} teams`;
            if (uibattleCount) uibattleCount.textContent = ` ${window.uibattleDataCount || 0} teams`;

            // Render table
            renderTable(1);
            showToast(` Loaded ${promptquestData.length} teams from cloud`);
        });

        // ===== EXPOSE RELOAD FUNCTION FOR REFRESH BUTTON =====
        window.reloadFirestoreData = async function () {
            console.log('[App] Refreshing table data...');

            // Reload both data sources
            promptquestData = await loadFromFirestore();
            await loadTestingData();

            // Update stats
            document.querySelector('.overview-card.purple .number').textContent = promptquestData.length;
            document.querySelector('.overview-card.green .number').textContent = promptquestData.length * 3;

            // Re-render table
            renderTable(1);

            console.log(`[App] Refreshed: ${promptquestData.length} teams loaded`);
        };


        /**
         * SECURITY: Enhanced Login Handler
         * - Rate limiting check (3 attempts per 15 minutes)
         * - Button debouncing
         * - Input validation
         * - Numeric token status display
         */
        window.handleLogin = function (event) {
            event.preventDefault();
            const email = document.getElementById("username").value.trim();
            const password = document.getElementById("password").value;
            const errorMessage = document.getElementById("errorMessage");
            const loginBtn = document.getElementById("loginBtn");

            errorMessage.style.display = "none";

            // SECURITY: Check rate limit before attempting login
            if (loginRateLimiter) {
                const rateResult = loginRateLimiter.tryConsume();

                // Update UI with current status (shows numbers)
                if (window.RateLimitUI) {
                    window.RateLimitUI.update(loginRateLimiter.getStatus());
                }

                if (!rateResult.allowed) {
                    errorMessage.style.display = "block";
                    errorMessage.textContent = ` ${rateResult.message} `;
                    console.warn('[Security] Login rate limit triggered:', rateResult.message);
                    return;
                }

                console.log(`[Security] Login attempt.Remaining: ${rateResult.tokens}/${rateResult.maxTokens}`);
            }

            // SECURITY: Button debouncing
            if (window.ButtonDebouncer) {
                window.ButtonDebouncer.setLoading(loginBtn, 'Signing in...');
            } else {
                loginBtn.disabled = true;
                loginBtn.textContent = 'Signing in...';
            }

            // SECURITY: Basic input validation
            if (!email || !password) {
                errorMessage.style.display = "block";
                errorMessage.textContent = "Please enter both email and password";
                if (window.ButtonDebouncer) {
                    window.ButtonDebouncer.restoreFromLoading(loginBtn);
                } else {
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'Sign In';
                }
                return;
            }

            if (password.length < 8) {
                errorMessage.style.display = "block";
                errorMessage.textContent = "Password must be at least 8 characters";
                if (window.ButtonDebouncer) {
                    window.ButtonDebouncer.restoreFromLoading(loginBtn);
                } else {
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'Sign In';
                }
                return;
            }

            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    console.log('[App] Login successful:', userCredential.user.email);
                    document.getElementById("login-page").style.display = "none";
                    document.getElementById("admin-dashboard").classList.add("active");
                })
                .catch((error) => {
                    console.warn('[Security] Login failed:', error.code);
                    errorMessage.style.display = "block";

                    // SECURITY: Don't reveal whether email exists
                    errorMessage.textContent = "Invalid email or password!";

                    // Show remaining attempts
                    if (loginRateLimiter) {
                        const status = loginRateLimiter.getStatus();
                        if (status.tokens <= 1) {
                            errorMessage.textContent += ` (${status.tokens} attempt${status.tokens === 1 ? '' : 's'} remaining)`;
                        }
                    }
                })
                .finally(() => {
                    if (window.ButtonDebouncer) {
                        window.ButtonDebouncer.restoreFromLoading(loginBtn);
                    } else {
                        loginBtn.disabled = false;
                        loginBtn.textContent = 'Sign In';
                    }
                });
        };

        window.addEventListener('DOMContentLoaded', () => {
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    signOut(auth).then(() => {
                        document.getElementById("admin-dashboard").classList.remove("active");
                        document.getElementById("login-page").style.display = "flex";
                    });
                });
            }
        });

        onAuthStateChanged(auth, (user) => {
            if (user) console.log("User authenticated:", user.email);
        });
    </script>
</body>

</html>